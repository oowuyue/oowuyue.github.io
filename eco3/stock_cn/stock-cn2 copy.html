<!DOCTYPE html>
<html lang="zh-CN" style="height: 100%">

<head>
    <meta charset="utf-8">
</head>

<body style="height: 100%;width: 100%; margin: 0">
    <div id="container" style="height: 100%; width: 100%;"></div>
    <script type="text/javascript" src="data/cn_cpi.js"></script>
    <script type="text/javascript" src="data/cn_ppi.js"></script>
    <script type="text/javascript" src="data/cn_cpi_minus_ppi.js"></script>
    <script type="text/javascript" src="data/getm1m2_legulegu.js"></script>

    <script type="text/javascript" src="data/cn_output_cars.js"></script>
    <script type="text/javascript" src="data/cn_output_circuit.js"></script>
    <script type="text/javascript" src="data/cn_output_steel.js"></script>
    <script type="text/javascript" src="data/cn_cars_sales.js"></script>
    <script type="text/javascript" src="data/cn_house_sale_area.js"></script>
    <script type="text/javascript" src="data/cn_trade.js"></script>

    <script type="text/javascript" src="data/cn_pmis.js"></script>
    <script type="text/javascript" src="data/M12_HS300.js"></script>


    <script type="text/javascript" src="data/cn_industry_indicator.js"></script>
    <script type="text/javascript" src="data/mm_manucycle.js"></script>



    <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.3.2/dist/echarts.min.js"></script>
    <script type="text/javascript">
        var dom = document.getElementById('container');
        var myChart = echarts.init(dom, "red", {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var app = {};
        var option;
        ////仅为了对齐时间
        Array.prototype.addStartEnd = function (start, end) {
            let arr = this
            arr = start.concat(arr)
            end.forEach((item) => {
                arr.push(item)
            })
            return arr
        }
        let currentDay = new Date()
        currentDay = currentDay.getFullYear() + "-" + (currentDay.getMonth() + 1) + "-" + currentDay.getDate()
        let justForAlignmentTime = []
        for (var i = 0; i < cn_cpi.cpi.length; i++) { justForAlignmentTime[i] = Array.from(cn_cpi.cpi[i]) }
        justForAlignmentTime = justForAlignmentTime.addStartEnd([], [
            [currentDay, " "]
        ]).map(item => {
            item[1] = ""
            return item
        })
        ////仅为了对齐时间

        //m1过年突变
        m1_legulegu = m1_legulegu.map(((item, index, arr) => {
            if (item[0].includes("01-28")) {
                let pre = m1_legulegu[index - 1]
                let next = m1_legulegu[index + 1]
                pre = pre ? parseFloat(pre[1]) : 0
                next = next ? parseFloat(next[1]) : 0
                if ((pre * next) != 0)
                    item[1] = (pre + next) / 2
                else
                    item[1] = (pre + next)
            }
            return item
        }))
        m1_m2_legulegu = m1_m2_legulegu.map(((item, index, arr) => {
            if (item[0].includes("01-28")) {
                let pre = m1_m2_legulegu[index - 1]
                let next = m1_m2_legulegu[index + 1]
                pre = pre ? parseFloat(pre[1]) : 0
                next = next ? parseFloat(next[1]) : 0
                if ((pre * next) != 0)
                    item[1] = (pre + next) / 2
                else
                    item[1] = (pre + next)
            }
            return item
        }))

        //产量平均
        function findSameTime(array, time) {
            for (let index = 0; index < array.length; index++) {
                const element = array[index];
                if (element[0] == time) return parseFloat(element[1])
            }
            return null
        }
        let cn_output_avg = cn_output_circuit.map((item, index) => {
            let newArr = []
            newArr[0] = item[0]
            let avg
            let circuit = parseFloat(item[1])
            let steel = findSameTime(cn_output_steel, item[0])
            let cars = findSameTime(cn_output_cars, item[0])
            if (steel == null && cars == null) avg = circuit
            else if (steel != null && cars != null) avg = (circuit + steel + cars) / 3
            else avg = (circuit + steel + cars) / 2
            newArr[1] = avg
            return newArr
        })
        //销量平均
        let cn_sale_avg = cn_trade.imExport_rate.map((item, index) => {
            let newArr = []
            newArr[0] = item[0]
            let avg
            let trade = parseFloat(item[1])
            let house = findSameTime(cn_house_sale_area.housesalearea, item[0])
            let car = findSameTime(cn_cars_sales, item[0])
            if (house == null && car == null) avg = trade
            else if (house != null && car != null) avg = (trade + house + car) / 3
            else avg = (trade + house + car) / 2
            newArr[1] = avg
            return newArr
        })
        //产销平均
        let cn_output_sale_avg = cn_sale_avg.map(item => {
            let newArr = []
            newArr[0] = item[0]
            let avg
            let output = findSameTime(cn_output_avg, item[0])
            if (output) avg = (item[1] + output) / 2
            else avg = item[1]
            newArr[1] = avg
            return newArr
        })

        //利润处理
        let lirunChuLi = cn_industry_indicator.industryindicator_profit.map((item, index) => {
            let newArr = []
            newArr[0] = item[0]
            newArr[1] = item[1] - cn_industry_indicator.industryindicator[index][1]
            return newArr
        })
        let lirunChuLi2 = cn_industry_indicator.industryindicator_profit.map((item, index) => {
            let newArr = []
            newArr[0] = item[0]
            newArr[1] = cn_industry_indicator.industryindicator[index][1] - item[1]
            return newArr
        })

        mm_manucycle = mm_manucycle.filter(item => {
            return parseFloat(item[0].substring(0, 4)) >= 2000
        }).map(item => {
            item[0] = item[0].substring(0, 8) + "28"
            item[1] = (parseFloat(item[1]) * 20).toFixed(2)
            return item
        })

        cn_pmi = cn_pmi.map(item => {
            item[1] = (item[1] - 50) * 10
            return item
        })
        cn_pmi_cx = cn_pmi_cx.map(item => {
            item[1] = (item[1] - 50) * 10
            return item
        })
        let cn_pmi_avg = cn_pmi.map((item, index) => {
            let newArr = []
            newArr[0] = item[0]
            let avg
            let cx = findSameTime(cn_pmi_cx, item[0])
            if (cx) avg = (item[1] * 0.5 + cx * 0.5)
            else avg = item[1]
            newArr[1] = avg
            return newArr
        })

        option = {
            title: {},
            tooltip: {
                trigger: 'axis',
                show: true,
                position: ['100%', '10%'],
                order: 'seriesDesc',
                axisPointer: {
                    type: 'cross',
                    show: false
                },
                formatter: function (params, ticket, callback) {
                    return null;
                }
            },
            legend: {
                type: "scroll",
                left: 60,
                width: "90%",
                inactiveColor: 'white',
                selector: ['all', 'inverse']
            },
            axisPointer: {
                link: [{
                    xAxisIndex: 'all'
                }],
                lineStyle: {
                    color: "red"
                }
            },
            dataZoom: [{
                show: true,
                realtime: true,
                start: 0,
                end: 100,
                xAxisIndex: [0, 1, 2, 3],
                bottom: -10
            },
            {
                type: 'inside',
                realtime: true,
                start: 0,
                end: 100,
                xAxisIndex: [0, 1, 2, 3],
            }
            ],

            grid: [
                {
                    left: 60,
                    right: 80,
                    top: "0.5%",
                    height: '32%',
                    show: true,
                    backgroundColor: '#c1c4c3',
                },
                {
                    left: 60,
                    right: 80,

                    top: "35%",
                    height: '30%',
                    show: true,
                    backgroundColor: '#c1c4c3',
                },
                {
                    left: 60,
                    right: 80,
                    top: "67%",
                    height: '30%',
                    show: true,
                    backgroundColor: '#c1c4c3',
                },
                {
                    left: 60,
                    right: 80,
                    top: "0.5%",
                    height: '96.5%',
                    show: true,
                    backgroundColor: '#c1c4c3',
                },
            ],

            xAxis: [
                {
                    gridIndex: 0,
                    type: "time",
                    axisPointer: {
                        show: true, //抓数据十字线焦点圆圈
                        label: {
                            show: false // 显示十字线竖线的时间
                        }
                    },
                    axisLabel: {
                        show: false // 显示图形底部时间
                    },
                },

                {
                    gridIndex: 1,
                    type: "time",
                    axisPointer: {
                        show: true,
                        label: {
                            show: false
                        }
                    },
                    axisLabel: {
                        show: false
                    },
                },
                {
                    gridIndex: 2,
                    type: "time",
                    axisPointer: {
                        show: true,
                        label: {
                            show: false
                        }
                    },
                    axisLabel: {
                        show: false
                    },

                },
                {
                    gridIndex: 3,
                    type: "time",
                    axisPointer: {
                        show: true, //抓数据十字线焦点圆圈
                        label: {
                            show: true // 显示十字线竖线的时间
                        }
                    },
                    axisLabel: {
                        show: true // 显示图形底部时间
                    },

                    splitNumber: 30,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: ['#aaa']
                        }
                    },
                    show: true, //显示0轴黑线
                    axisLine: {
                        show: false //显示0轴黑线
                    },
                },
            ],

            yAxis: [
                {
                    gridIndex: 0,
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                },
                {
                    gridIndex: 1,
                    type: 'value',
                    splitLine: {
                        show: true
                    },
                    position: "right"
                },
                {
                    gridIndex: 2,
                    type: 'value',
                    splitLine: {
                        show: true
                    },
                    position: "right",

                },
                {
                    gridIndex: 3,
                    type: 'value',
                    splitLine: {
                        show: true
                    },
                    position: "right",
                },

            ],

            series: [

                {
                    name: 'ppi',
                    type: 'line',
                    xAxisIndex: 0,
                    yAxisIndex: 0,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 2,
                        color: "#037a6f"
                    },
                    data: cn_ppi.ppi,
                },

                {
                    name: 'pmi_avg',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 2,
                        color: "black"
                    },
                    data: cn_pmi_avg,
                },

                {
                    name: 'M1',
                    type: 'line',
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 2,

                    },
                    data: m1_legulegu,
                },

                {
                    name: 'HS300',
                    type: 'line',
                    xAxisIndex: 3,
                    yAxisIndex: 3,
                    showSymbol: false,
                    lineStyle: {
                        width: 0,
                    },
                    itemStyle: {
                        normal: {
                            areaStyle: {
                                color: "#fdc375"
                            },
                        },
                        emphasis: {
                            areaStyle: {
                                color: "#fdc375"
                            },
                        }
                    },
                    data: HS300
                },

                ///以下仅为了对齐时间
                {
                    name: '',
                    type: 'line',
                    xAxisIndex: 0,
                    yAxisIndex: 0,
                    tooltip: false,
                    data: justForAlignmentTime,
                    showSymbol: false,
                    lineStyle: {
                        width: 0,
                        color: "black"
                    },
                },
                {
                    name: '',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    tooltip: false,
                    data: justForAlignmentTime,
                    showSymbol: false,
                    lineStyle: {
                        width: 2,
                        color: "black"
                    },
                },
                {
                    name: '',
                    type: 'line',
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    tooltip: false,
                    data: justForAlignmentTime,
                    showSymbol: false,
                    lineStyle: {
                        width: 0,
                        color: "black"
                    },
                },
                {
                    name: '',
                    type: 'line',
                    xAxisIndex: 3,
                    yAxisIndex: 3,
                    tooltip: false,
                    data: justForAlignmentTime,
                    showSymbol: false,
                    lineStyle: {
                        width: 0,
                        color: "black"
                    },
                },
            ]
        };

        if (option && typeof option === 'object') {
            myChart.setOption(option);
        }
        window.addEventListener('resize', myChart.resize);
    </script>
</body>

</html>