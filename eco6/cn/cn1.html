<!DOCTYPE html>
<html lang="zh-CN" style="height: 100%">

<head>
    <meta charset="utf-8">
    <script type="text/javascript" src="jslib/my.js"></script>
    <script type="text/javascript" src="data/CPI,PPI,CPI_PPI.js"></script>
    <script type="text/javascript" src="data/财新制造业PMI,官方制造业PMI.js"></script>
    <script type="text/javascript" src="data/利润同比,亏损增减.js"></script>
    <script type="text/javascript" src="data/商品房销售.js"></script>
    <script type="text/javascript" src="data/零售汽车.js"></script>
    <script type="text/javascript" src="data/出口.js"></script>
    <script type="text/javascript" src="data/股债差300平均.js"></script>
    <script type="text/javascript" src="data/沪深300PE中位数,全A股PE中位数,十年期国债利率倒数.js"></script>
    <script type="text/javascript" src="data/沪深300同比,上证同比.js"></script>
    <script type="text/javascript" src="data/M1,M1_M2.js"></script>
    <script type="text/javascript" src="data/信贷脉冲,房价同比,沪深300Day.js"></script>
    <script type="text/javascript" src="data/社融存量.js"></script>
    <script>
        CPI = CPI.filter(item => {
            return parseFloat(item[0].substring(0, 4)) >= 2000
        })
        PPI = PPI.filter(item => {
            return parseFloat(item[0].substring(0, 4)) >= 2000
        })

        let MA = 4 //https://www.jianshu.com/p/d709fe2be814
        let PPI_MA = PPI.map((item, index) => {
            const copyItem = [...item];
            if (index < MA) {
                return copyItem
            }

            let sum = 0
            for (let i = index - MA; i < index; i++) {
                sum += parseFloat(PPI[i][1])
            }
            let avg = (sum / MA).toFixed(2)

            copyItem[1] = avg
            return copyItem
        })

        function findSameTime(array, time) {
            for (let index = 0; index < array.length; index++) {
                const element = array[index];
                if (element[0] == time) return parseFloat(element[1])
            }
            return null
        }
        官方制造业PMI = 官方制造业PMI.map(item => {
            item[1] = parseFloat(((item[1] - 50) * 1).toFixed(2))
            return item
        })
        财新制造业PMI = 财新制造业PMI.map(item => {
            item[1] = parseFloat(((item[1] - 50) * 1).toFixed(2))
            return item
        })
        let cn_pmi_平均 = 官方制造业PMI.map((item, index) => {
            let newArr = []
            newArr[0] = item[0]
            let avg
            let cx = findSameTime(财新制造业PMI, item[0])
            if (cx) avg = (item[1] * 0.5 + cx * 0.5).toFixed(2)
            else avg = item[1].toFixed(2)
            newArr[1] = parseFloat(avg)
            return newArr
        }).filter(item => {
            return true //parseFloat(item[0].substring(0, 4)) >= 2008
        })

        M1 = M1.map(((item, index, arr) => {
            if (item[0].includes("01-28")) {
                let pre = M1[index - 1]
                let next = M1[index + 1]
                pre = pre ? parseFloat(pre[1]) : 0
                next = next ? parseFloat(next[1]) : 0
                if ((pre * next) != 0)
                    item[1] = (pre + next) / 2
                else
                    item[1] = (pre + next)
            }
            return item
        }))
        let M1_MA = M1.map((item, index) => {
            const copyItem = [...item];
            if (index < MA) {
                //item[1]=0
                return copyItem
            }

            let sum = 0
            for (let i = index - MA; i < index; i++) {
                sum += parseFloat(M1[i][1])
            }
            let avg = (sum / MA).toFixed(2)

            copyItem[1] = avg
            return copyItem
        })
        // let M1_MACD =  M1.map((item, index) => {
        //     return {date:item[0] , close:item[1]}
        // }).calMacd()
        // console.log(M1_MACD)

        let 信贷脉冲_MA = 信贷脉冲.map((item, index) => {
            const copyItem = [...item];
            if (index < MA) {
                return copyItem
            }

            let sum = 0
            for (let i = index - MA; i < index; i++) {
                sum += parseFloat(信贷脉冲[i][1])
            }
            let avg = (sum / MA).toFixed(2)

            copyItem[1] = avg
            return copyItem
        })

        出口 = 出口.map(((item, index, arr) => {
            if (item[0].includes("02-28")) {
                let pre = 出口[index - 1]
                let next = 出口[index + 1]
                pre = pre ? parseFloat(pre[1]) : 0
                next = next ? parseFloat(next[1]) : 0
                if ((pre * next) != 0)
                    item[1] = (pre + next) / 2
                else
                    item[1] = (pre + next)
            }
            return item
        }))
        零售汽车 = 零售汽车.map(((item, index, arr) => {
            if (item[0].includes("02-28")) {
                let pre = 零售汽车[index - 1]
                let next = 零售汽车[index + 1]
                pre = pre ? parseFloat(pre[1]) : 0
                next = next ? parseFloat(next[1]) : 0
                if ((pre * next) != 0)
                    item[1] = (pre + next) / 2
                else
                    item[1] = (pre + next)
            }
            return item
        }))
        let 零售汽车$出口 = 出口.map((output, index, datasArr) => {

            let car = 零售汽车.find(ele => ele[0] == output[0])
            let newItem = []
            if (car) {
                newItem[0] = output[0]
                newItem[1] = (parseFloat(output[1]) + parseFloat(car[1])) / 2
                return newItem
            } else {
                newItem[0] = output[0]
                newItem[1] = output[1]
                return newItem
            }
        })
    </script>
    <script type="text/javascript" src="data/雪球行情/沪深300_xueqiu_day.js"></script>
    <script>
        function xueqiuFormatDate(stamp, period = "month") {
            var date = new Date(stamp);
            var y = date.getFullYear(),
                m = date.getMonth() + 1,
                d = date.getDate();
            if (m < 10)
                m = '0' + m;
            if (d < 10)
                d = '0' + d;

            if (period == "month") {
                var current_date = new Date();
                var current_y = current_date.getFullYear(),
                    current_m = current_date.getMonth() + 1,
                    current_d = current_date.getDate();
                if (current_m < 10)
                    current_m = '0' + current_m;
                if (current_d < 10)
                    current_d = '0' + current_d;

                if ((y + '-' + m) == (current_y + '-' + current_m)) { //当月不处理
                    var t = y + '-' + m + '-' + d;
                } else {
                    var t = y + '-' + m + '-28';
                }
            }

            if (period == "day") {
                var t = y + '-' + m + '-' + d;
            }


            return t;
        }

        function sectorIndexToObj(ele, period = "month") {
            let newItem = {}
            newItem.stamp = ele[0]
            newItem.date = xueqiuFormatDate(ele[0], period)
            newItem.open = ele[2] //open
            newItem.close = ele[5] //close
            return newItem
        }

        function sectorIndexYoY(ele, index, datasArr) {

            const preItem = datasArr.find(element => {
                let preYear = '' + (parseInt(ele.date.slice(0, 4)) - 1) + ele.date.substring(4, 10)
                return element.date == preYear
            })
            if (preItem) {
                let openYoY = (ele.open - preItem.open) / preItem.open
                let closeYoY = (ele.close - preItem.close) / preItem.close
                let highYoY = (ele.high - preItem.high) / preItem.high
                let lowYoY = (ele.low - preItem.low) / preItem.low
                ele.openYoY = openYoY
                ele.closeYoY = closeYoY
                ele.highYoY = highYoY
                ele.lowYoY = lowYoY
            } else {
                ele.openYoY = ""
                ele.closeYoY = ""
                ele.highYoY = ""
                ele.lowYoY = ""
            }
            return ele

        }

        沪深300_xueqiu_day = 沪深300_xueqiu_day.data.item.map((ele) => {
            return sectorIndexToObj(ele, "day")
        })
        // 沪深300_xueqiu_month = 沪深300_xueqiu_month.data.item.map((ele) => {
        //     return sectorIndexToObj(ele, "month")
        // })
        // 沪深300_xueqiu_month = 沪深300_xueqiu_month.map((ele, index, arr) => {
        //     return sectorIndexYoY(ele, index, arr, 沪深300_xueqiu_month)
        // })
        // let 沪深300_xueqiu_month_openYoY = 沪深300_xueqiu_month.map((item) => {
        //     let tmp = []
        //     tmp[0] = item.date
        //     tmp[1] = item.openYoY ? item.openYoY * 100 : ""
        //     return tmp
        // }).filter(item => {
        //     return parseFloat(item[0].substring(0, 4)) >= 2008
        // })
    </script>
    <script type="text/javascript" src="data/恐贪指数.js"></script>
    <script type="text/javascript" src="data/基金平衡型.js"></script>
    <script type="text/javascript" src="data/基金股票型.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>
    <script>
        //https://legulegu.com/stockdata/fund-position/pos-stock 手动下载
        //https://api.jiucaishuo.com/v2/kjtl/kjtlconnect  https://app.jiucaishuo.com/pagesA/highchart/greedy?kt_type=1 默认加密了
        let cdefault = {
            "iv": "h5.jiucaishuo.com",
            "ivv": "h5.jiucaishuo.comaaaaaaaaaaaaaaa",
        }
        let P = CryptoJS
        let o = {
            iv: P.enc.Utf8.parse(cdefault.iv),
            mode: P.mode.CBC,
            padding: P.pad.Pkcs7
        }
        let r = cdefault.ivv
        jsonData = JSON.parse(P.AES.decrypt(恐贪指数, P.enc.Utf8.parse(r), o).toString(P.enc.Utf8))
        恐贪指数 = jsonData.data.xAxis.categories.map((item, index) => {
            return [item, parseFloat(jsonData.data.series[0].data[index])]
        })

        let 基金持仓
        let 基金持仓$恐贪指数
        if (typeof (股票型date) != "undefined") {
            let 基金股票型 = 股票型date.map((item, index) => {
                return [item, parseFloat(股票型data[index])]
            }).filter((item) => {
                return !isNaN(item[1])
            })
            let 基金平衡型 = 平衡型date.map((item, index) => {
                return [item, parseFloat(平衡型data[index])]
            }).filter((item) => {
                return !isNaN(item[1])
            })


            基金持仓 = 基金平衡型.map((item, index) => {
                return [item[0], (item[1] + 基金股票型[index][1]) / 2]
            })


            基金持仓$恐贪指数 = 基金持仓.map((item, index) => {
                let fearItem = 恐贪指数.find(ele => ele[0] == item[0])
                if (fearItem)
                    return [item[0], item[1], fearItem[1]]
                else
                    return [item[0], item[1], NaN]
            }).filter((item) => {
                return !isNaN(item[2])
            }).map((item) => {
                item[1] = item[1] * 0.35 + item[2] * 0.65
                return item
            })
        }
        else {
            基金持仓$恐贪指数 = 恐贪指数
            基金持仓$恐贪指数 = 基金持仓$恐贪指数.map((item, index, arr) => {
                let MA = 5;
                const copyItem = [...item];
                if (index < MA) return copyItem

                let sum = 0
                for (let i = index - MA; i < index; i++) {
                    sum += parseFloat(arr[i][1])
                }
                let avg = (sum / MA).toFixed(2)
                copyItem[1] = avg
                return copyItem
            }).filter((item, index, arr) => {
                return (index == arr.length - 1) || ((index + 1) % 5 == 0)
            })

        }
        console.log(基金持仓$恐贪指数)
    </script>
    <script type="text/javascript" src="data/同花顺策略/同花顺策略统计.js"></script>
    <script>
        function countStat(json, name = "kdj日周月", Period = "day") {
            let countJson = {}
            json.forEach((element) => {
                let startTime = Period == "month" ? element[2].substring(0, 7) : element[2] //month day
                if (countJson[startTime]) {
                    countJson[startTime].count += 1;
                    countJson[startTime].detail.push(element);
                } else {
                    countJson[startTime] = { count: 1, detail: [element] }
                }
            })

            let countArr = []
            for (var key of Object.keys(countJson)) {
                startTime = Period == "month" ? key + "-28" : key //month day
                countArr.push([startTime, countJson[key].count, name])
            }

            return countArr
        }

        let 左侧长短周期组合统计 = []
        let 右侧长短周期组合统计 = []

        let 日周信号组合统计 = []
        let 日周信号组合2统计 = []

        let 日买入信号组合统计 = []
        let 日买入信号组合2统计 = []

        let 技术指标Contact = []

        if (typeof (左侧长短周期组合) != "undefined") {
            左侧长短周期组合统计 = countStat(左侧长短周期组合, "左侧长短周期组合")
        }
        if (typeof (右侧长短周期组合) != "undefined") {
            右侧长短周期组合统计 = countStat(右侧长短周期组合, "右侧长短周期组合")
        }

        if (typeof (日周信号组合) != "undefined") {
            日周信号组合统计 = countStat(日周信号组合, "日周信号组合")
        }
        if (typeof (日周信号组合2) != "undefined") {
            日周信号组合2统计 = countStat(日周信号组合2, "日周信号组合2")
        }

        if (typeof (日买入信号组合) != "undefined") {
            日买入信号组合统计 = countStat(日买入信号组合, "日买入信号组合")
        }
        if (typeof (日买入信号组合2) != "undefined") {
            日买入信号组合2统计 = countStat(日买入信号组合2, "日买入信号组合2")
        }

        统计Contact = [...左侧长短周期组合统计, ...右侧长短周期组合统计, ...日周信号组合统计, ...日周信号组合2统计, ...日买入信号组合统计, ...日买入信号组合2统计]
        统计Contact.sort(function (a, b) {
            return new Date(a[0]) - new Date(b[0])
        })
        统计Contact = 统计Contact.map((ele) => {
            return {
                date: ele[0],
                count: ele[1],
                quanName: ele[2]
            }
        })

        function groupBy(objectArray, property) {
            return objectArray.reduce((acc, obj) => {
                const key = obj[property];
                const curGroup = acc[key] ?? [];

                return { ...acc, [key]: [...curGroup, obj] };
            }, {});
        }
        let 统计byDate = groupBy(统计Contact, "date")
        let 统计byName = groupBy(统计Contact, "quanName");

        let 技术指标统计 = []
        for (let dateKey in 统计byDate) {
            let sum = 统计byDate[dateKey].reduce((acc, cruEle) => {
                acc += cruEle.count
                return acc
            }, 0)
            //日期   总数 策略数已经单个策略数的总数
            技术指标统计.push([dateKey, sum, 统计byDate[dateKey]])
        }
        //console.log(技术指标统计)


        if (typeof (smallDown) == "undefined") smallDown = []
        if (typeof (bigcontinueslow) == "undefined") bigcontinueslow = []

    </script>

    <script type="text/javascript" src="data/雪球行情/大盘策略.js"></script>
    <script type="text/javascript" src="data/雪球行情/证券策略.js"></script>
    <script>
        证券策略 = [
            ...中信证券策略, ...光大证券策略, ...国泰君安策略, ...中信建投策略,
            ...招商证券策略, ...广发证券策略,
            ...东方财富策略, ...同花顺策略, ...恒生电子策略
        ]
        证券策略 = 证券策略.map((item) => {
            return [item.trigDate, item.trigDatePercent]
        })


        上证指数策略 = 上证指数策略.map((item) => {
            return [item.trigDate, item.trigDatePercent]
        })
        沪深300策略 = 沪深300策略.map((item) => {
            return [item.trigDate, item.trigDatePercent]
        })

        console.log(上证指数策略)
    </script>


    <script type="text/javascript" src="data/新浪期货行情/1大宗策略.js"></script>
    <script>
        大宗策略 = 大宗策略.map((item) => {
            let mostLow100orLast = item.day100LowUp ? item.day100LowUp[1] : item[`day${item.lastDay}LowUp`][1]
            let mostUp100orLast = item.day100LowUp ? item.day100LowUp[3] : item[`day${item.lastDay}LowUp`][3]
            return [item.trigDateCod1, mostLow100orLast, mostUp100orLast, item.name]
        })
        console.log(大宗策略)
    </script>

</head>

<body style="height: 100%; margin: 0">
    <div id="container" style="height: 100%"></div>
    <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.3.2/dist/echarts.min.js"></script>
    <script type="text/javascript">
        Array.prototype.addStartEnd = function () {
            let arr = this
            let start = [["2000-01-01", ""]]
            arr = start.concat(arr)

            //当天 或 hs300最后一天 
            let currentDay = new Date()
            let lastDay = currentDay.getFullYear() + 1 + "-" + (currentDay.getMonth() + 1) + "-" + currentDay.getDate()
            // let lastDay = 沪深300_xueqiu_day[沪深300_xueqiu_day.length - 1].date

            let found = arr.find((element) => element[0] == lastDay);
            if (!found) arr.push([lastDay, ""])
            return arr
        }


        var dom = document.getElementById('container');
        var myChart = echarts.init(dom, "#fff", {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var app = {};
        var option;

        let gridbackgroundColor = "#f7f9fa"
        let splitLineColor = "#d8d8d8"
        option = {
            title: {},
            tooltip: {
                trigger: "axis", //item cross,
                show: true,
                position: ['30%', '80%'],
                order: 'seriesDesc',
                axisPointer: {
                    type: "cross",
                    show: true,
                    crossStyle: {
                        width: 0.5,
                        color: "black", // 鼠标十字横轴
                    },
                },
                //formatter: '{a}: {c}',
                formatter: function (params) {
                    if (params.seriesName && params.seriesName.includes("策略")) {
                        return params.seriesName + params.data
                    }
                }
            },
            legend: {
                // data: ['M1', 'M1-M2', "PPI", "股GDP比", "股债比", "上证"],
                top: 550,
                left: 53,
                height: 500,
                width: 300
            },
            toolbox: {},
            axisPointer: {
                link: [{
                    xAxisIndex: 'all'
                }],
                lineStyle: {
                    width: 0.7,
                    color: "black", // 鼠标十字竖轴
                },
            },
            dataZoom: [{
                show: true,
                realtime: true,
                start: 0,
                end: 100,
                bottom: -10,
                xAxisIndex: [0, 1, 2, 3, 4, 5],
            },
            {
                type: 'inside',
                realtime: true,
                start: 0,
                end: 100,
                xAxisIndex: [0, 1, 2, 3, 4, 5]
            }
            ],

            grid: [
                { //沪深300
                    left: 60,
                    right: 80,
                    top: "0%",
                    height: '50%',
                    backgroundColor: '#fafffd',
                    show: true,
                },

                {  //基金&恐贪
                    left: 60,
                    right: 80,
                    top: "0%",
                    height: '13%',
                },

                { //中位PE 同比
                    left: 60,
                    right: 80,
                    top: "13%",
                    height: '17%',
                },

                { //pmi
                    left: 60,
                    right: 80,
                    top: "30%",
                    height: '20%',

                },

                { //ppi
                    left: 60,
                    right: 80,
                    top: "50%",
                    height: '22%',
                    backgroundColor: '#fafffd',
                    show: true,
                },

                { //m12
                    left: 60,
                    right: 80,
                    top: "72%",
                    height: '25%',
                    backgroundColor: '#fafffd',
                    show: true,
                },


            ],
            xAxis: [
                {   //沪深300
                    gridIndex: 0,
                    type: 'time',
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: false,//不抓取
                        label: {
                            show: false,//不现实抓取时间
                        },
                    },
                    axisLabel: {
                        fontSize: 10,
                        formatter: "{yyyy}",
                        padding: [0, -60, 0, 0],
                    },
                },

                { //基金&恐贪
                    gridIndex: 1,
                    type: 'time',
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true,
                        label: {
                            show: false,
                        },
                    },
                    axisLabel: {
                        show: false
                    }

                },

                { //中位PE 同比
                    gridIndex: 2,
                    type: 'time',
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true,
                        label: {
                            show: false,
                        },
                    },
                    axisLabel: {
                        show: false
                    }
                },


                { //pmi
                    gridIndex: 3,
                    type: 'time',
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true,
                        label: {
                            show: false,
                        },
                    },
                    axisLabel: {
                        show: false
                    }
                },
                { //ppi
                    gridIndex: 4,
                    type: 'time',
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true,
                        label: {
                            show: true,
                        },
                    },
                    axisLabel: {
                        show: false
                    }
                },
                { //m12  
                    gridIndex: 5,
                    type: 'time',
                    splitNumber: 20,
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: [splitLineColor]
                        }
                    },
                    axisPointer: {
                        show: true,
                        label: {
                            show: false,
                        },
                    },
                    axisLabel: {
                        show: false
                    }
                },


            ],
            yAxis: [

                {
                    gridIndex: 0, //300指数
                    type: 'value',
                    splitLine: {
                        "show": false//去掉网格线
                    },
                    min: 700
                },

                {
                    gridIndex: 1, //基金&恐贪
                    name: '',
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        formatter: (value, index) => {
                            if ([35, 75,].includes(value)) return value
                            else return ""
                        }
                    },
                    show: true,
                    min: 20,
                    interval: 5,
                    position: "right"
                },

                {
                    gridIndex: 2,//中位 同比
                    name: '',
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    show: true,
                    position: "right",
                    // axisLabel: {
                    //     formatter: (value, index) => {
                    //         if ([-50, -30, -20, 0, 20, 30, 35].includes(value)) return value
                    //         else return ""
                    //     }
                    // },
                    //interval: 5,
                    max: 43,
                    min: 15,
                },



                {
                    gridIndex: 3, //pmi  
                    name: '',
                    type: 'value',

                    splitLine: {
                        show: false
                    },

                    axisLabel: {
                        formatter: (value, index) => {
                            if ([-10, 10].includes(value)) return value
                            else return ""
                        }
                    },
                    interval: 5,
                    max: 50,
                    min: -25,
                    position: "right"
                },


                {
                    gridIndex: 4, //ppi
                    type: 'value',

                    splitLine: {
                        show: false
                    },
                    show: true,
                    axisLabel: {
                        formatter: (value, index) => {
                            if (value > 10 || value < -10) return ""
                            else return value
                        }
                    },
                    min: -8,
                    position: "right"
                },

                {
                    gridIndex: 5, //信贷社融
                    name: '',
                    type: 'value',

                    splitLine: {
                        show: false
                    },
                    show: true,
                    axisLabel: {
                        formatter: (value, index) => {
                            if (value > 35 || value < -20) return ""
                            else return value
                        }
                    },
                    max: 40,
                    min: 20,
                    position: "right"

                },

                //对面
                {
                    gridIndex: 5, //M12
                    name: '',
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        // formatter: (value, index) => {
                        //     if ([-50, -30, -20, 0, 30, 50, 70, 100].includes(value)) return value
                        //     else return ""
                        // }
                        color: "black"
                    },
                    // max: 35,
                    // min: 1,
                    position: "letf"

                },
                {
                    gridIndex: 1, //同花顺策略  1,7
                    name: '',
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        show: false
                    },
                    show: false,
                    // max: 7,
                    // min: 0,
                    position: "letf"

                },

                {
                    gridIndex: 2, //大盘证券策略
                    name: '',
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        show: false
                    },
                    show: false,
                    // max: 7,
                    // min: 0.5,
                    position: "letf"

                },

                {
                    gridIndex: 3, //大宗策略
                    name: '',
                    type: 'value',
                    splitLine: {
                        show: false
                    },
                    axisLabel: {
                        show: true
                    },
                    show: true,
                    max: 90,
                    min: -46,
                    position: "letf"

                },
            ],

            series: [
                {
                    name: '沪深300',
                    type: 'line',
                    //smooth: true,
                    xAxisIndex: 0,
                    yAxisIndex: 0,
                    showSymbol: false,
                    silent: true,
                    itemStyle: {
                        normal: {
                            areaStyle: {
                                color: "#87c5cf" // FFAA33   9ACD32
                            },
                        },
                        emphasis: {
                            areaStyle: {
                                color: "#87c5cf",
                            },
                        },
                    },
                    lineStyle: {
                        width: 0
                    },
                    data: 沪深300_xueqiu_day.map((item) => {
                        let tmp = []
                        tmp[0] = item.date
                        tmp[1] = item.close ? item.close : ""
                        return tmp
                    }).addStartEnd()
                },

                {
                    name: '恐贪&基金',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1,
                        color: "gray"
                    },
                    markLine: {
                        symbol: ["none", "none"],
                        data: [{
                            lineStyle: {
                                width: 0.5,
                                color: "red",
                                //type: "solid" // 实线，不写默认虚线
                            },
                            label: {
                                formatter: "",
                                color: "red",
                                fontSize: "0",
                                position: "start",
                            },
                            yAxis: 75, // 标线值
                            x: "83%",
                        },
                        {
                            lineStyle: {
                                width: 0.5,
                                color: "green",
                            },
                            label: {
                                formatter: "",
                                color: "green",
                                fontSize: "10",
                                position: "insideStartBottom",
                            },
                            yAxis: 35, // 标线值
                            x: "83%", //固定起点的 x 像素位置
                        },
                        ],
                    },
                    data: 基金持仓$恐贪指数.addStartEnd()
                },

                {
                    name: "中位PE", //300剔除后中位
                    type: "line",
                    xAxisIndex: 2,
                    yAxisIndex: 2,

                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1,
                        color: "gray"
                    },
                    markLine: {
                        symbol: ["none", "none"],
                        data: [{
                            lineStyle: {
                                width: 0.7,
                                color: "#ff535c",
                            },
                            label: {
                                position: "insideStartTop",
                                formatter: "28高估",
                                fontSize: "8",
                                color: "#ff535c",
                            },
                            yAxis: 28,
                            //x: "5%", //固定起点的 x 像素位置
                        },
                        {
                            lineStyle: {
                                width: 0.7,
                                color: "green",
                            },
                            label: {
                                position: "insideStartBottom",
                                formatter: "20低估",
                                fontSize: "8",
                                color: "green",
                            },
                            yAxis: 20,
                            // x: "5%", //固定起点的 x 像素位置
                        },
                        ],
                    },
                    data: 沪深300PE中位数.addStartEnd()
                },
                {
                    name: "沪深300同比", //
                    type: "line",
                    xAxisIndex: 2,
                    yAxisIndex: 2,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1.5,
                    },
                    itemStyle: {
                        normal: {
                            color: {
                                type: "linear",
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [{
                                    offset: 0.45, //大 下
                                    color: "red",
                                },
                                {
                                    offset: 0.6,
                                    color: "orange",
                                },

                                {
                                    offset: 0.8, //小 上
                                    color: "green",
                                },
                                ],
                                globalCoord: true,
                            },
                        },
                    },
                    markLine: {
                        symbol: ["none", "none"],
                        data: [{
                            lineStyle: {
                                width: 0.5,
                                color: "green",
                            },
                            label: {
                                formatter: "-20低估",
                                color: "green",
                                fontSize: "10",
                                position: "insideStartBottom",
                            },
                            yAxis: -20, // 标线值
                            //x: "6.5%", //固定起点的 x 像素位置
                        },
                        {
                            lineStyle: {
                                width: 0.5,
                                color: "red",
                            },
                            label: {
                                formatter: "30高估",
                                color: "red",
                                fontSize: "10",
                                position: "insideStartTop",
                            },
                            yAxis: 30, // 标线值
                            // x: "6.5%",
                        },
                        {
                            lineStyle: {
                                width: 0.5,
                                color: "gray",
                                //type: "solid" // 实线，不写默认虚线
                            },
                            label: {
                                formatter: "30高估",
                                color: "red",
                                fontSize: "0",
                                position: "start",
                            },
                            yAxis: 0, // 标线值
                        },
                        ],
                    },
                    data: 沪深300同比.filter(item => {
                        return parseFloat(item[0].substring(0, 4)) >= 2008
                    }).addStartEnd()
                },

                {
                    name: 'PMI',
                    type: 'line',
                    xAxisIndex: 3,
                    yAxisIndex: 3,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1,
                        color: "#ee82ee"
                    },

                    markLine: {
                        symbol: ["none", "none"],
                        data: [

                            {
                                lineStyle: {
                                    width: 0.5,
                                    color: "gray",
                                },
                                label: {
                                    formatter: "上穿10,15",
                                    color: "#ff535c",
                                    fontSize: 8,
                                    position: "insideStartTop",
                                },
                                yAxis: 15, // 标线值
                            },

                            {
                                lineStyle: {
                                    width: 0.5,
                                    color: "gray",
                                },
                                label: {
                                    formatter: "",
                                    color: "#ff535c",
                                    fontSize: 8,
                                    position: "insideStartTop",
                                },
                                yAxis: 10, // 标线值
                            },

                            {
                                lineStyle: {
                                    width: 0.5,
                                    color: "gray",
                                },
                                label: {
                                    formatter: "",
                                    color: "#0081B6",
                                    fontSize: 8,
                                    position: "insideStartBottom",
                                },
                                yAxis: -7, // 标线值
                            },

                            {
                                lineStyle: {
                                    width: 0.5,
                                    color: "gray",
                                },
                                label: {
                                    formatter: "下穿-7,-10",
                                    color: "#0081B6",
                                    fontSize: 8,
                                    position: "insideStartBottom",
                                },
                                yAxis: -10, // 标线值
                            }
                        ],
                    },

                    data: cn_pmi_平均.filter(item => {
                        return parseFloat(item[0].substring(0, 4)) >= 2006
                    }).map(v => {
                        v[1] = parseFloat(v[1]) * 10
                        return v
                    }).addStartEnd()

                },
                {
                    name: "房地产$汽车与出口",
                    type: "line",
                    xAxisIndex: 3,
                    yAxisIndex: 3,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1.3,
                        color: "#ff4d57" //"#ff8c00"
                    },
                    data: 商品房销售.addStartEnd()
                },
                {
                    name: "房地产$汽车与出口",
                    type: "line",
                    xAxisIndex: 3,
                    yAxisIndex: 3,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1.2,
                        color: "#a45db2" //"#fd5f21",
                    },
                    data: 零售汽车$出口.addStartEnd()
                },

                {
                    name: 'PPI',
                    type: 'line',
                    xAxisIndex: 4,
                    yAxisIndex: 4,
                    smooth: true,
                    showSymbol: false,
                    markLine: {
                        symbol: ["none", "none"],
                        data: [{
                            type: "average",
                            lineStyle: {
                                type: "solid",
                                width: 1,
                                color: "#ff535c",
                            },
                            label: {
                                formatter: "5 PPI高值",
                                fontSize: "8",
                                color: "#ff535c",
                                position: "insideStartTop",
                            },
                            yAxis: 5, // 标线值

                        },
                        {
                            type: "average",
                            lineStyle: {
                                width: 0,
                            },
                            label: {
                                formatter: "0 PPI低值",
                                fontSize: "8",
                                color: "#0079cd",
                                position: "insideStartBottom",
                            },
                            yAxis: 0, // 标线值
                        },
                        ],
                    },
                    itemStyle: {
                        "color": {
                            "type": "linear",
                            "x": 0,
                            "y": 0,
                            "x2": 0,
                            "y2": 1,
                            "colorStops": [{
                                "offset": 0.29,
                                "color": "#fc737b"
                            },

                            {
                                "offset": 1,
                                "color": "#0079cd"
                            }
                            ],
                            "globalCoord": false
                        }
                    },

                    lineStyle: {
                        width: 1.5,
                    },
                    data: PPI.filter(item => {
                        return parseFloat(item[0].substring(0, 4)) >= 2000
                    }).addStartEnd()
                },
                {
                    name: 'PPI_MA',
                    type: 'line',
                    xAxisIndex: 4,
                    yAxisIndex: 4,
                    smooth: true,
                    showSymbol: false,
                    itemStyle: {
                        "color": {
                            "type": "linear",
                            "x": 0,
                            "y": 0,
                            "x2": 0,
                            "y2": 1,
                            "colorStops": [{
                                "offset": 0.29,
                                "color": "#fc737b"
                            },

                            {
                                "offset": 1,
                                "color": "#0079cd"
                            }
                            ],
                            "globalCoord": false
                        }
                    },

                    lineStyle: {
                        width: 1.5,
                        type: "dotted"
                    },
                    data: PPI_MA.filter(item => {
                        return parseFloat(item[0].substring(0, 4)) >= 2000
                    }).addStartEnd()
                },

                {
                    name: '信贷脉冲',
                    type: 'line',
                    xAxisIndex: 5,
                    yAxisIndex: 5,
                    smooth: true,
                    showSymbol: false,
                    itemStyle: {
                        "color": {
                            "type": "linear",
                            "x": 0,
                            "y": 0,
                            "x2": 0,
                            "y2": 1,
                            "colorStops": [{
                                "offset": 0.7,
                                "color": "green"
                            },
                            {
                                "offset": 0.5,
                                "color": "orange"
                            },

                            {
                                "offset": 0.3,
                                "color": "red"
                            }

                            ],
                            "globalCoord": false
                        }

                    },
                    zlevel: 5,
                    lineStyle: {
                        width: 1.5,
                    },
                    data: 信贷脉冲.addStartEnd()
                },
                {
                    name: '信贷脉冲_MA',
                    type: 'line',
                    xAxisIndex: 5,
                    yAxisIndex: 5,
                    smooth: true,
                    showSymbol: false,

                    itemStyle: {
                        "color": {
                            "type": "linear",
                            "x": 0,
                            "y": 0,
                            "x2": 0,
                            "y2": 1,
                            "colorStops": [{
                                "offset": 0.75,
                                "color": "green"
                            },
                            {
                                "offset": 0.5,
                                "color": "orange"
                            },

                            {
                                "offset": 0.3,
                                "color": "red"
                            }

                            ],
                            "globalCoord": false
                        }

                    },
                    zlevel: 5,
                    lineStyle: {
                        width: 1.5,
                        type: 'dotted',
                    },
                    data: 信贷脉冲_MA
                },
                {
                    name: "社融存量",
                    type: "line",
                    xAxisIndex: 5,
                    yAxisIndex: 5,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1.3,
                        // color: "black",//"#ff5c5c",
                        // type: "dotted"

                    },
                    data: 社融存量.addStartEnd(),
                },

                {
                    name: 'M1',
                    type: 'line',
                    xAxisIndex: 5,
                    yAxisIndex: 6,
                    smooth: true,
                    showSymbol: false,
                    lineStyle: {
                        width: 1.2,
                        color: " black"
                    },
                    zlevel: 5,
                    data: M1.addStartEnd()
                },
                {
                    name: "M1_MA",
                    type: "line",
                    xAxisIndex: 5,
                    yAxisIndex: 6,
                    showSymbol: false,
                    smooth: true,
                    lineStyle: {
                        width: 1,
                        color: "black", //"#ff5c5c",
                        type: "dotted"
                    },
                    zlevel: 5,
                    data: M1_MA,
                },


                {
                    name: '策略总数',
                    type: 'scatter',
                    xAxisIndex: 1,
                    yAxisIndex: 7,
                    symbol: "pin",
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "#a417ff"
                        }
                    },
                    symbolSize: function (val) {
                        return 10
                    },
                    zlevel: 3,
                    data: 技术指标统计.filter(ele => {
                        return ele[1] >= 3 || ele[2].length >= 2
                    }).addStartEnd()

                },
                {
                    name: '策略数',
                    type: 'scatter',
                    xAxisIndex: 1,
                    yAxisIndex: 7,
                    symbol: "pin",
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "#ff2ca5"
                        }
                    },
                    symbolSize: function (val) {
                        return 7
                    },
                    zlevel: 3,
                    data: 技术指标统计.filter(ele => {
                        return ele[1] >= 3 || ele[2].length >= 2
                    }).map(ele => {
                        return [ele[0], ele[2].length]
                    }).addStartEnd()

                },
                {
                    name: '小市值亏损',
                    type: 'scatter',
                    xAxisIndex: 1,
                    yAxisIndex: 7,
                    symbol: 'path://M12.0002 21.4142L17.4144 16L16.0002 14.5858L13.0002 17.5858V3H11.0002V17.5858L8.00015 14.5858L6.58594 16L12.0002 21.4142Z',
                    itemStyle: {
                        normal: {
                            opacity: 2,
                            color: "black"
                        }
                    },
                    symbolSize: function (val) {
                        return 8
                    },
                    zlevel: 6,
                    data: smallDown.filter(ele => parseFloat(ele[6].substring(0, ele[6].length - 1)) < -3).map((item) => {
                        return [item[3], parseFloat(item[6].substring(0, item[6].length - 1))]
                    }).addStartEnd()
                },
                {
                    name: '大市值连亏',
                    type: 'scatter',
                    xAxisIndex: 1,
                    yAxisIndex: 7,
                    symbol: 'path://M12.0002 21.4142L17.4144 16L16.0002 14.5858L13.0002 17.5858V3H11.0002V17.5858L8.00015 14.5858L6.58594 16L12.0002 21.4142Z',
                    itemStyle: {
                        normal: {
                            opacity: 2,
                            color: "blue"
                        }
                    },
                    symbolSize: function (val) {
                        return 9
                    },
                    zlevel: 6,
                    data: bigcontinueslow.filter((item, index, arr) => {
                        let prePreItem = arr[index - 2]
                        if (prePreItem)
                            return (item[3] == 2) && (item[4] < -14) && (parseFloat(prePreItem[1].substring(0, prePreItem[1].length - 1)) < 30)
                        else
                            return (item[3] == 2) && (item[4] < -14)
                    }).map((item) => {
                        return [item[0], parseFloat(item[1].substring(0, item[1].length - 1))]
                    }).addStartEnd()
                },


                {
                    name: '证券策略',
                    type: 'scatter',
                    xAxisIndex: 2,
                    yAxisIndex: 8,
                    symbol: "pin",
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "#f39a4f"
                        }
                    },
                    symbolSize: function (val) {
                        return 10
                    },
                    zlevel: 3,
                    data: 证券策略.addStartEnd()
                },
                {
                    name: '上证指数策略',
                    type: 'scatter',
                    xAxisIndex: 2,
                    yAxisIndex: 8,
                    symbol: "path://M12.0002 3.58569L19.4144 10.9999L18.0002 12.4141L13.0002 7.41412V19.9999H11.0002V7.41412L6.00015 12.4141L4.58594 10.9999L12.0002 3.58569Z",
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "#a417ff"
                        }
                    },
                    symbolSize: function (val) {
                        return 12
                    },
                    zlevel: 3,
                    data: 上证指数策略.filter(ele => { return parseFloat(ele[0].substring(0, 4)) >= 2000 }).addStartEnd()
                },
                {
                    name: '沪深300策略',
                    type: 'scatter',
                    xAxisIndex: 2,
                    yAxisIndex: 8,
                    symbol: "path://M12.0002 3.58569L19.4144 10.9999L18.0002 12.4141L13.0002 7.41412V19.9999H11.0002V7.41412L6.00015 12.4141L4.58594 10.9999L12.0002 3.58569Z",
                    itemStyle: {
                        normal: {
                            opacity: 1,
                            color: "red"
                        }
                    },
                    symbolSize: function (val) {
                        return 10
                    },
                    zlevel: 3,
                    data: 沪深300策略.addStartEnd()
                },



                {
                    name: '大宗策略',
                    type: 'candlestick',
                    xAxisIndex: 3,
                    yAxisIndex: 9,

                    zlevel: 3,
                    data: 大宗策略.map((item) => {
                        let tmp = []
                        tmp[0] = item[0]//date
                        tmp[1] = 0
                        tmp[2] = item[1] < -7 ? -0.00000000001 : 0
                        tmp[3] = item[1] //low
                        tmp[4] = item[2] //up
                        tmp[5] = item[3] //name
                        return tmp
                    }).addStartEnd()
                },

            ]
        };


        if (option && typeof option === 'object') {
            myChart.setOption(option);
        }
        window.addEventListener('resize', myChart.resize)

        myChart.on('legendselectchanged', function (params) {

            if (params.name.includes("同比")) { //初次点击显示 hs300&全A中位&十年倒数   hs300同比
                if (params.selected[params.name]) {
                    option.yAxis[2].max = 100
                    option.yAxis[2].min = -50
                    params.selected.中位PE = false
                    option.legend.selected = params.selected
                    myChart.setOption(option)
                }
            }
            if (params.name == "中位PE") {
                option.yAxis[2].max = 50
                option.yAxis[2].min = 15
                for (let legendName in params.selected) {
                    if (legendName.includes("同比")) {
                        params.selected[legendName] = false
                    }
                }
                option.legend.selected = params.selected
                myChart.setOption(option)
            }



            if (params.name == "社融存量") {
                if (params.selected.社融存量) {
                    option.yAxis[5].max = 15
                    option.yAxis[5].min = 8
                    for (let legendName in params.selected) {
                        if (legendName.includes("信贷")) {
                            params.selected[legendName] = false
                        }
                    }
                    option.legend.selected = params.selected
                    myChart.setOption(option)
                }
            }
            if (params.name.includes("信贷脉冲")) {
                option.yAxis[5].max = 40
                option.yAxis[5].min = 20
                for (let legendName in params.selected) {
                    if (legendName.includes("社融存量")) {
                        params.selected[legendName] = false
                    }
                }
                option.legend.selected = params.selected
                myChart.setOption(option)
            }


        })

        setTimeout(() => {

            ["沪深300同比", "房地产$汽车与出口", "M1", "M1_MA",
                "证券策略", "上证指数策略", "沪深300策略",
                "策略总数", "策略数", "小市值亏损", "大市值连亏","大宗策略"
            ].forEach(legendName => {
                myChart.dispatchAction({
                    type: 'legendToggleSelect',
                    name: legendName
                });
            });

        }, "1")
    </script>
</body>

</html>